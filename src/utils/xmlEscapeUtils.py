class XmlEscapeUtil:
    """
    用于转义 XML 内容中的特殊字符, 使其可以安全嵌入到 XML 中
    """

    # 定义需要转义的 XML 字符及其对应实体
    _escape_map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        # https://github.com/HengXin666/BiLiBiLi_DanMu_Crawling/issues/21
        # '"': '&quot;',
        # "'": '&apos;',
    }

    @classmethod
    def escape(cls, text: str) -> str:
        """
        转义给定字符串中的 XML 特殊字符。
        
        Args:
            text (str): 原始字符串
        
        Returns:
            str: 已转义的字符串
        """
        # 注意顺序: 必须先转义 &, 否则后续转义会把实体搞坏
        for char, escape in cls._escape_map.items():
            text = text.replace(char, escape)
        return text

if __name__ == '__main__':
    raw = "<tag>O'Reilly & <friends></tag>"
    escaped = XmlEscapeUtil.escape(raw)
    print(escaped == "&lt;tag&gt;O&apos;Reilly &amp; &lt;friends&gt;&lt;/tag&gt;")

    print(XmlEscapeUtil.escape("""Tvar fontData =
{
	size: 14,
	underlinePosition: 23.7031,
	underlineThickness: 0.929688,
	width: 28,
	height: 25,
	glyphCount: 27,
	ascender: 20,
	descender: -5,
	'C':
	{
		advanceHori: 12,
		commands: $.toIntVector([1,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3]),
		paths: $.toNumberVector([11,19.4375,9.45313,20,7.42188,20,5.42188,20,3.96875,19.2344,2.53125,18.4688,1.76563,17.0625,1,15.6406,1,13.7813,1,11.7969,1.84375,10.25,2.70313,8.6875,4.26563,7.84375,5.82813,7,7.85938,7,9.48438,7,11,7.40625,11,11,10.4844,10.5313,9.75,10.2656,9.03125,10,8.29688,10,6.76563,10,5.875,10.9531,5,11.8906,5,13.5156,5,15.125,5.875,16.0625,6.76563,17,8.25,17,9.60938,17,11,16]),
		kernings: {}
	},
	'O':
	{
		advanceHori: 15,
		commands: $.toIntVector([1,3,3,3,3,3,3,3,3,3,3,3,3,1,3,3,3,3,3,3,3,3,3]),
		paths: $.toNumberVector([14,13.4531,14,15.3594,13.1563,16.8594,12.3281,18.3438,10.8125,19.1719,9.3125,20,7.45313,20,5.64063,20,4.14063,19.2031,2.65625,18.3906,1.82813,16.9531,1,15.5,1,13.6563,1,11.75,1.82813,10.2188,2.67188,8.67188,4.1875,7.84375,5.70313,7,7.625,7,9.48438,7,10.9375,7.8125,12.4063,8.60938,13.2031,10.0938,14,11.5781,14,13.4531,10,13.5781,10,11.9219,9.34375,10.9688,8.70313,10,7.59375,10,6.35938,10,5.67188,10.9219,5,11.8438,5,13.5156,5,15.1563,5.67188,16.0781,6.35938,17,7.53125,17,8.23438,17,8.79688,16.5938,9.375,16.1719,9.6875,15.4063,10,14.6406,10,13.5781]),
		kernings: {}
	},
	'M':
	{
		advanceHori: 19,
		commands: $.toIntVector([1,2,3,2,2,3,2,2,2,3,2,3,2,2,2,2,2,3,3,2,3,2,2,2]),
		paths: $.toNumberVector([13,20,13,12.8281,13,11.8125,13.0625,10.6094,13.0938,10,12.9844,10,12.7031,11.5469,12.5625,12.1406,10.75,20,7.26563,20,5.35938,12.2188,5.28125,11.9375,4.96875,10,4.85938,10,5,13.0625,5,13.8281,5,20,1,20,1,7,6.95313,7,8.76563,14.0781,8.82813,14.2969,8.9375,14.9688,9.04688,15.6406,9.0625,16,9.125,16,9.21875,15.1719,9.45313,14.0469,11.1406,7,17,7,17,20]),
		kernings: {}
	},
	'P':
	{
		advanceHori: 12,
		commands: $.toIntVector([1,3,3,3,2,2,2,2,2,3,3,1,3,3,2,2,2,3]),
		paths: $.toNumberVector([12,11.375,12,12.7344,11.2969,13.7969,10.5938,14.8438,9.28125,15.4219,7.98438,16,6.25,16,5,16,5,20,1,20,1,7,6.51563,7,9.35938,7,10.6719,8.0625,12,9.125,12,11.375,8,11.5156,8,10.7656,7.45313,10.3906,6.92188,10,5.875,10,5,10,5,13,6.03125,13,8,13,8,11.5156]),
		kernings: {}
	},
	'S':
	{
		advanceHori: 11,
		commands: $.toIntVector([1,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3]),
		paths: $.toNumberVector([10,16.0469,10,17.2813,9.32813,18.2031,8.67188,19.1094,7.46875,19.5625,6.26563,20,4.57813,20,2.625,20,1,19.3594,1,16,1.8125,16.4531,2.79688,16.7344,3.79688,17,4.64063,17,5.29688,17,5.64063,16.7813,6,16.5625,6,16.1406,6,15.8438,5.82813,15.6094,5.65625,15.375,5.3125,15.1875,4.96875,14.9844,4.03125,14.6406,1,13.5,1,10.9375,1,9.14063,2.28125,8.07813,3.57813,7,5.75,7,6.375,7,6.875,7.0625,7.39063,7.10938,7.8125,7.20313,8.23438,7.28125,9,7.53125,9,11,7.59375,10,6.23438,10,5.6875,10,5.34375,10.2344,5,10.4688,5,10.875,5,11.25,5.29688,11.5156,5.59375,11.7656,6.54688,12.1719,8.4375,12.9375,9.21875,13.8594,10,14.7813,10,16.0469]),
		kernings: {}
	},
	'E':
	{
		advanceHori: 10,
		commands: $.toIntVector([1,2,2,2,2,2,2,2,2,2,2,2]),
		paths: $.toNumberVector([1,20,1,7,9.6875,7,9.6875,10,5,10,5,12,9,12,9,15,5,15,5,17,10,17,10,20]),
		kernings: {}
	},
	'k':
	{
		advanceHori: 11,
		commands: $.toIntVector([1,2,2,2,2,2,2,2,2,2,2,2,2]),
		paths: $.toNumberVector([6.96875,20,5.03125,15,5,15,5,20,1,20,1,6,5,6,5,15,5.03125,15,6.79688,10,10.8594,10,8,14.5781,11,20]),
		kernings: {}
	},
	'z':
	{
		advanceHori: 10,
		commands: $.toIntVector([1,2,2,2,2,2,2,2,2,2]),
		paths: $.toNumberVector([5,17,9,17,9,20,0,20,0,18.1094,4,13,0,13,0,10,8.92188,10,8.92188,12.3281]),
		kernings: {}
	},
	' ':
	{
		advanceHori: 5,
		commands: null,
		paths: null,
		kernings: {}
	},
	'L':
	{
		advanceHori: 10,
		commands: $.toIntVector([1,2,2,2,2,2]),
		paths: $.toNumberVector([1,20,1,7,5,7,5,17,10,17,10,20]),
		kernings: {}
	},
	'i':
	{
		advanceHori: 6,
		commands: $.toIntVector([1,3,3,3,3,3,3,3,3,1,2,2,2]),
		paths: $.toNumberVector([5.21875,7.48438,5.21875,8.15625,4.59375,8.57813,3.98438,9,2.98438,9,2.01563,9,1.39063,8.5625,0.765625,8.125,0.765625,7.48438,0.765625,6.8125,1.35938,6.40625,1.96875,6,2.98438,6,3.98438,6,4.59375,6.40625,5.21875,6.8125,5.21875,7.48438,1,20,1,10,5,10,5,20]),
		kernings: {}
	},
	'v':
	{
		advanceHori: 11,
		commands: $.toIntVector([1,2,2,2,2,3,2,3,3,2]),
		paths: $.toNumberVector([7.75,20,3.125,20,0,10,4.0625,10,5.20313,15.875,5.46875,17.2813,5.5,18,5.5625,18,5.57813,17.7969,5.60938,17.5781,5.64063,17.3438,6.96875,10,11,10]),
		kernings: {}
	},
	'e':
	{
		advanceHori: 11,
		commands: $.toIntVector([1,3,3,3,2,3,3,3,3,3,3,3,3,3,2,1,3,3,3]),
		paths: $.toNumberVector([5,16,5.10938,16.4688,5.71875,16.7344,6.32813,17,7.34375,17,8.75,17,10,17,10,19.4375,8.51563,20,6.40625,20,3.84375,20,2.42188,18.7344,1,17.4531,1,15.2188,1,13.6719,1.625,12.5,2.25,11.3281,3.48438,10.6719,4.71875,10,6.20313,10,7.71875,10,8.79688,10.5625,9.875,11.125,10.4375,12.1563,11,13.1719,11,14.5469,11,16,7,14,7,12,6.01563,12,5.59375,12,5.3125,12.5469,5.03125,13.0938,4.98438,14]),
		kernings: {}
	},
	't':
	{
		advanceHori: 8,
		commands: $.toIntVector([1,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3]),
		paths: $.toNumberVector([8,19.6563,7.71875,19.7813,7.09375,19.8906,6.46875,20,5.59375,20,3.90625,20,2.95313,19.0938,2,18.1875,2,16.5,2,13,0,13,0,10,2,10,2,8.09375,6,7,6,10,8,10,8,13,6,13,6,15.7813,6,17,7,17,7.46875,17,8,17]),
		kernings: {}
	},
	'u':
	{
		advanceHori: 12,
		commands: $.toIntVector([1,2,2,3,3,3,3,3,2,2,2,3,3,3,2,2,2]),
		paths: $.toNumberVector([7,20,7,19,6.96875,19,6.48438,19.4063,6.09375,19.5938,5.71875,19.7656,5.23438,19.8906,4.75,20,4.10938,20,2.59375,20,1.79688,18.9688,1,17.9219,1,15.8906,1,10,5,10,5,15.5625,5,17,5.95313,17,6.46875,17,6.73438,16.6094,7,16.2188,7,15.5156,7,10,11,10,11,20]),
		kernings: {}
	},
	'n':
	{
		advanceHori: 12,
		commands: $.toIntVector([1,2,3,3,3,3,2,2,2,2,2,2,3,3,3,2]),
		paths: $.toNumberVector([7,20,7,14.6875,7,13.7813,6.75,13.3906,6.51563,13,5.98438,13,5.51563,13,5.25,13.4063,5,13.8125,5,14.4531,5,20,1,20,1,10,5,10,5,12,5.03125,12,5.5,11.0469,6.26563,10.5313,7.04688,10,7.96875,10,11,10,11,14.0469,11,20]),
		kernings: {}
	},
	'N':
	{
		advanceHori: 15,
		commands: $.toIntVector([1,2,3,2,3,2,2,2,2,2,3,3,3,3,2,3,2,2,2]),
		paths: $.toNumberVector([10.5313,20,5.89063,13.4063,5.34375,12.625,4.98438,12,4.95313,12,5,13.0156,5,14.2656,5,20,1,20,1,7,4.71875,7,9.14063,12.7969,9.21875,12.9063,9.34375,13.0625,9.46875,13.2188,9.57813,13.3906,9.70313,13.5625,9.79688,13.7188,9.90625,13.875,9.96875,14,10,14,9.9375,13.6094,9.9375,12.6563,9.9375,7,14,7,14,20]),
		kernings: {}
	},
	'G':
	{
		advanceHori: 14,
		commands: $.toIntVector([1,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,2,2,2,2]),
		paths: $.toNumberVector([13,18.9375,12.2656,19.3438,10.8125,19.6719,9.375,20,8.0625,20,4.6875,20,2.84375,18.3438,1,16.6875,1,13.7188,1,11.7188,1.92188,10.1719,2.84375,8.60938,4.51563,7.8125,6.1875,7,8.45313,7,10.1094,7,12,7.5,12,11,11.1094,10.4375,10.2813,10.2188,9.46875,10,8.5,10,6.90625,10,5.95313,10.9688,5,11.9219,5,13.5938,5,15.1875,5.79688,16.0938,6.59375,17,8.01563,17,8.6875,17,9,17,9,15,7,15,7,12,13,12]),
		kernings: {}
	},
	'H':
	{
		advanceHori: 15,
		commands: $.toIntVector([1,2,2,2,2,2,2,2,2,2,2,2]),
		paths: $.toNumberVector([10,20,10,15,5,15,5,20,1,20,1,7,5,7,5,12,10,12,10,7,14,7,14,20]),
		kernings: {}
	},
	'a':
	{
		advanceHori: 11,
		commands: $.toIntVector([1,2,2,3,3,3,3,2,3,3,3,2,3,3,3,3,2,1,3,3,3,3,2,2,3]),
		paths: $.toNumberVector([6,20,6,19,5.96875,19,4.98438,20,2.96875,20,1.57813,20,0.78125,19.2656,0,18.5313,0,17.2813,0,14.6875,3.5625,14.2813,6,14,6,13.125,5.57813,12.5625,5.15625,12,4.4375,12,2.8125,12,1,13,1,10.6875,1.8125,10.3906,3.03125,10.2031,4.26563,10,5.14063,10,7.70313,10,8.84375,11.0625,10,12.125,10,14.6094,10,20,4,17.1094,4,17.5,4.20313,17.75,4.42188,18,4.8125,18,5.34375,18,5.67188,17.5469,6,17.0781,6,16.3594,6,16,4.85938,16.1875,4,16.3438,4,17.1094]),
		kernings: {}
	},
	's':
	{
		advanceHori: 9,
		commands: $.toIntVector([1,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3]),
		paths: $.toNumberVector([9,16.4063,9,18.1094,7.73438,19.0625,6.46875,20,4.20313,20,3.54688,20,2.57813,19.8906,1.60938,19.7656,1,19.5781,1,17,2.71875,18,3.85938,18,5,18,5,17.3594,5,17.0938,4.73438,16.9219,4.46875,16.75,3.35938,16.3438,2.125,15.9219,1.5625,15.2188,1,14.5156,1,13.3906,1,11.8281,2.15625,10.9219,3.3125,10,5.40625,10,6.625,10,8,10.3594,8,13,7.46875,12.5781,6.82813,12.2969,6.20313,12,5.78125,12,5.42188,12,5.20313,12.1406,5,12.2813,5,12.5156,5,12.8125,5.25,12.9844,5.5,13.1563,6.26563,13.4063,7.73438,13.8594,8.35938,14.5781,9,15.2813,9,16.4063]),
		kernings: {}
	},
	'D':
	{
		advanceHori: 14,
		commands: $.toIntVector([1,3,3,3,2,2,2,3,1,3,3,3,2,2,2,3,3]),
		paths: $.toNumberVector([14,13.3438,14,15.3125,13.1094,16.8281,12.2344,18.3438,10.5938,19.1719,8.96875,20,6.84375,20,1,20,1,7,6.71875,7,14,7,14,13.3438,10,13.375,10,12.4063,9.53125,11.625,9.07813,10.8438,8.21875,10.4219,7.35938,10,6.20313,10,5,10,5,17,6.3125,17,8,17,9,16.0156,10,15.0313,10,13.375]),
		kernings: {}
	},
	'A':
	{
		advanceHori: 14,
		commands: $.toIntVector([1,2,2,2,2,2,2,2,1,2,3,3,2,2,3]),
		paths: $.toNumberVector([9.60938,20,9.01563,18,5.01563,18,4.375,20,0,20,4.625,7,9.64063,7,14,20,7.0625,10,6.98438,10,6.96875,10.2188,6.875,10.7188,6.79688,11.2188,6,15,8,15,7.26563,11.4688,7.10938,10.6875,7.0625,10]),
		kernings: {}
	},
	'K':
	{
		advanceHori: 13,
		commands: $.toIntVector([1,2,3,2,2,2,2,2,2,2,3,2,2,2,2]),
		paths: $.toNumberVector([8.64063,20,5.39063,15.7031,5.0625,15.1875,5,15,5,15,5,20,1,20,1,7,5,7,5,13,5,13,5.20313,12.5313,5.45313,12.125,8.51563,7,14,7,9,13.2031,14,20]),
		kernings: {}
	},
	'U':
	{
		advanceHori: 14,
		commands: $.toIntVector([1,3,3,3,3,2,2,2,3,3,3,3,2,2]),
		paths: $.toNumberVector([13,13.9375,13,17.0156,11.5,18.5156,10.0156,20,6.90625,20,4,20,2.5,18.5156,1,17.0156,1,14.0156,1,7,5,7,5,14.3594,5,15.6406,5.51563,16.3281,6.03125,17,7,17,7.98438,17,8.48438,16.3594,9,15.7188,9,14.4531,9,7,13,7]),
		kernings: {}
	},
	'o':
	{
		advanceHori: 12,
		commands: $.toIntVector([1,3,3,3,3,3,3,3,3,3,3,1,3,3,3,3]),
		paths: $.toNumberVector([12,14.8281,12,17.25,10.5469,18.625,9.09375,20,6.48438,20,3.89063,20,2.4375,18.6563,1,17.3125,1,14.9375,1,13.4219,1.67188,12.3125,2.35938,11.1875,3.60938,10.5938,4.85938,10,6.5,10,8.1875,10,9.42188,10.625,10.6719,11.25,11.3281,12.3594,12,13.4688,12,14.8281,8,14.8594,8,13,6.5,13,5,13,5,14.9531,5,17,6.51563,17,8,17,8,14.8594]),
		kernings: {}
	},
	'h':
	{
		advanceHori: 12,
		commands: $.toIntVector([1,2,3,3,3,2,2,2,2,2,2,3,3,3,3,2]),
		paths: $.toNumberVector([7,20,7,14.4531,7,13,6,13,5.51563,13,5.25,13.4219,5,13.8281,5,14.4688,5,20,1,20,1,6,5,6,5,12,5.03125,12,5.54688,11.0313,6.26563,10.5156,7,10,7.84375,10,9.39063,10,10.1875,11.0156,11,12.0313,11,14,11,20]),
		kernings: {}
	}
};"""))